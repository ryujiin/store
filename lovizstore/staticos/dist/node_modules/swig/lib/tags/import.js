var utils=require("../utils");exports.compile=function(e,t){var n=t.pop(),r="_ctx."+n+' = {};\n  var _output = "";\n',i=utils.map(t,function(e){return{ex:new RegExp("_ctx."+e.name,"g"),re:"_ctx."+n+"."+e.name}});return utils.each(t,function(e){var t=e.compiled;utils.each(i,function(e){t=t.replace(e.ex,e.re)}),r+=t}),r},exports.parse=function(e,t,n,r,i,s,o){var u=require("../parser").compile,a={resolveFrom:s.filename},f=utils.extend({},s,a),l,c;return n.on(r.STRING,function(e){var n=this;if(!l){l=o.parseFile(e.match.replace(/^("|')|("|')$/g,""),a).tokens,utils.each(l,function(e){var t="",r;if(!e||e.name!=="macro"||!e.compile)return;r=e.args[0],t+=e.compile(u,e.args,e.content,[],f)+"\n",n.out.push({compiled:t,name:r})});return}throw new Error("Unexpected string "+e.match+" on line "+t+".")}),n.on(r.VAR,function(e){var n=this;if(!l||c)throw new Error('Unexpected variable "'+e.match+'" on line '+t+".");if(e.match==="as")return;return c=e.match,n.out.push(c),!1}),!0},exports.block=!0;