/*!
 * Export methods publicly
 */

function efn(){return""}function validateOptions(e){if(!e)return;utils.each(["varControls","tagControls","cmtControls"],function(t){if(!e.hasOwnProperty(t))return;if(!utils.isArray(e[t])||e[t].length!==2)throw new Error('Option "'+t+'" must be an array containing 2 different control strings.');if(e[t][0]===e[t][1])throw new Error('Option "'+t+'" open and close controls must not be the same.');utils.each(e[t],function(e,n){if(e.length<2)throw new Error('Option "'+t+'" '+(n?"open ":"close ")+'control must be at least 2 characters. Saw "'+e+'" instead.')})});if(e.hasOwnProperty("cache")&&e.cache&&e.cache!=="memory")if(!e.cache.get||!e.cache.set)throw new Error("Invalid cache option "+JSON.stringify(e.cache)+' found. Expected "memory" or { get: function (key) { ... }, set: function (key, value) { ... } }.');if(e.hasOwnProperty("loader")&&e.loader)if(!e.loader.load||!e.loader.resolve)throw new Error("Invalid loader option "+JSON.stringify(e.loader)+" found. Expected { load: function (pathname, cb) { ... }, resolve: function (to, from) { ... } }.")}var utils=require("./utils"),_tags=require("./tags"),_filters=require("./filters"),parser=require("./parser"),dateformatter=require("./dateformatter"),loaders=require("./loaders");exports.version="1.4.2";var defaultOptions={autoescape:!0,varControls:["{{","}}"],tagControls:["{%","%}"],cmtControls:["{#","#}"],locals:{},cache:"memory",loader:loaders.fs()},defaultInstance;exports.setDefaults=function(e){validateOptions(e),defaultInstance.options=utils.extend(defaultInstance.options,e)},exports.setDefaultTZOffset=function(e){dateformatter.tzOffset=e},exports.Swig=function(e){function i(e){return!e||!e.locals?t.options.locals:utils.extend({},t.options.locals,e.locals)}function s(e){return e=e||{},e.hasOwnProperty("cache")&&!e.cache||!t.options.cache}function o(e,n){if(s(n))return;return t.options.cache==="memory"?t.cache[e]:t.options.cache.get(e)}function u(e,n,r){if(s(n))return;if(t.options.cache==="memory"){t.cache[e]=r;return}t.options.cache.set(e,r)}function a(e,t){return utils.map(t,function(t){var n=t.args?t.args.join(""):"";return t.name==="block"&&e[n]&&(t=e[n]),t.content&&t.content.length&&(t.content=a(e,t.content)),t})}function f(e,t){var n=[];utils.each(e,function(e){n.push(e)}),utils.each(n.reverse(),function(e){e.name!=="block"&&t.unshift(e)})}function l(e,n){var r=e.parent,i=[],s=[],u,l,c;while(r){if(!n||!n.filename)throw new Error('Cannot extend "'+r+'" because current template has no filename.');u=u||n.filename,u=t.options.loader.resolve(r,u),l=o(u,n)||t.parseFile(u,utils.extend({},n,{filename:u})),r=l.parent;if(i.indexOf(u)!==-1)throw new Error('Illegal circular extends of "'+u+'".');i.push(u),s.push(l)}c=s.length;for(c=s.length-2;c>=0;c-=1)s[c].tokens=a(s[c].blocks,s[c+1].tokens),f(s[c].blocks,s[c].tokens);return s}validateOptions(e),this.options=utils.extend({},defaultOptions,e||{}),this.cache={},this.extensions={};var t=this,n=_tags,r=_filters;this.invalidateCache=function(){t.options.cache==="memory"&&(t.cache={})},this.setFilter=function(e,t){if(typeof t!="function")throw new Error('Filter "'+e+'" is not a valid function.');r[e]=t},this.setTag=function(e,t,r,i,s){if(typeof t!="function")throw new Error('Tag "'+e+'" parse method is not a valid function.');if(typeof r!="function")throw new Error('Tag "'+e+'" compile method is not a valid function.');n[e]={parse:t,compile:r,ends:i||!1,block:!!s}},this.setExtension=function(e,n){t.extensions[e]=n},this.parse=function(e,s){validateOptions(s);var o=i(s),u={},a;for(a in s)s.hasOwnProperty(a)&&a!=="locals"&&(u[a]=s[a]);return s=utils.extend({},t.options,u),s.locals=o,parser.parse(this,e,s,n,r)},this.parseFile=function(e,n){var r;return n||(n={}),e=t.options.loader.resolve(e,n.resolveFrom),r=t.options.loader.load(e),n.filename||(n=utils.extend({filename:e},n)),t.parse(r,n)},this.precompile=function(e,n){var r=t.parse(e,n),i=l(r,n),s,o;i.length&&(r.tokens=a(r.blocks,i[0].tokens),f(r.blocks,r.tokens));try{s=new Function("_swig","_ctx","_filters","_utils","_fn",'  var _ext = _swig.extensions,\n    _output = "";\n'+parser.compile(r,i,n)+"\n"+"  return _output;\n")}catch(u){utils.throwError(u,null,n.filename)}return{tpl:s,tokens:r}},this.render=function(e,n){return t.compile(e,n)()},this.renderFile=function(e,n,r){if(r){t.compileFile(e,{},function(e,t){var i;if(e){r(e);return}try{i=t(n)}catch(s){r(s);return}r(null,i)});return}return t.compileFile(e)(n)},this.compile=function(e,n){function h(e){var n;return e&&l?n=utils.extend({},f,e):e&&!l?n=e:!e&&l?n=f:n={},c.tpl(t,n,r,utils,efn)}var s=n?n.filename:null,a=s?o(s,n):null,f,l,c;return a?a:(f=i(n),l=utils.keys(f).length,c=this.precompile(e,n),utils.extend(h,c.tokens),s&&u(s,n,h),h)},this.compileFile=function(e,n,r){var i,s;n||(n={}),e=t.options.loader.resolve(e,n.resolveFrom),n.filename||(n=utils.extend({filename:e},n)),s=o(e,n);if(s){if(r){r(null,s);return}return s}if(r){t.options.loader.load(e,function(e,i){if(e){r(e);return}var s;try{s=t.compile(i,n)}catch(o){r(o);return}r(e,s)});return}return i=t.options.loader.load(e),t.compile(i,n)},this.run=function(e,n,s){var o=i({locals:n});return s&&u(s,{},e),e(t,o,r,utils,efn)}},defaultInstance=new exports.Swig,exports.setFilter=defaultInstance.setFilter,exports.setTag=defaultInstance.setTag,exports.setExtension=defaultInstance.setExtension,exports.parseFile=defaultInstance.parseFile,exports.precompile=defaultInstance.precompile,exports.compile=defaultInstance.compile,exports.compileFile=defaultInstance.compileFile,exports.render=defaultInstance.render,exports.renderFile=defaultInstance.renderFile,exports.run=defaultInstance.run,exports.invalidateCache=defaultInstance.invalidateCache,exports.loaders=loaders;